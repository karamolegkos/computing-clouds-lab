# Container για τον Καιρό της Αθήνας (Python)

Αυτό το πρόγραμμα καλεί το **OpenWeather API** κάθε 60 δευτερόλεπτα και εμφανίζει τα δεδομένα του καιρού για την Αθήνα.

Θα δούμε βήμα–βήμα πώς να το βάλουμε να τρέχει μέσα σε ένα Docker container.

## Τι πρέπει να προσέχουμε όταν γράφουμε Dockerfile
Το Dockerfile είναι ο "**οδηγός κατασκευής**" για το container μας.

Κάθε γραμμή (εντολή) που γράφουμε δημιουργεί ένα νέο layer στην τελική εικόνα (image). Όσο πιο προσεκτικοί είμαστε, τόσο πιο ελαφρύ, ασφαλές και γρήγορο θα είναι το image μας.

1. Επιλογή κατάλληλης "βάσης" (base image)

Η πρώτη γραμμή είναι πάντα η βάση, π.χ.:
```Dockerfile
FROM python:3.12-slim
```
  - Επιλέγουμε την πιο ελαφριά έκδοση που καλύπτει τις ανάγκες μας (π.χ. `-slim` ή `-alpine`).
  - Αποφεύγουμε γενικά latest, γιατί μπορεί να αλλάξει απρόσμενα στο μέλλον. Αν θέλουμε σταθερότητα, γράφουμε συγκεκριμένη έκδοση.

Παραδειγματικά:
- Η πλήρης έκδοση `python:3.12` είναι περίπου **900**MB,
- ενώ η `python:3.12-slim` μόλις **150**MB!

2. Εγκατάσταση μόνο των απαραίτητων

Κάθε `RUN` που προσθέτουμε αυξάνει το μέγεθος του image. Γι’ αυτό:
  - Εγκαθιστούμε μόνο ό,τι χρειαζόμαστε, π.χ. τη βιβλιοθήκη `requests`.
  - Χρησιμοποιούμε την επιλογή `--no-install-recommends` για τα system packages.
  - Καθαρίζουμε τα temporary αρχεία μετά την εγκατάσταση.

3. `WORKDIR` και `COPY`

Αυτές οι εντολές καθορίζουν πού θα μπει ο κώδικας μέσα στο container.
  - **WORKDIR** `/app`: Ορίζει τον "φάκελο εργασίας".
  - **COPY** `main.py` `/app/main.py`: Αντιγράφει το αρχείο Python μέσα.

4. Αποφυγή εκτέλεσης ως `root`

Προεπιλεγμένα, το container τρέχει ως `root`, κάτι που είναι επικίνδυνο. Αν κάποιος εκμεταλλευτεί το container, αποκτά πρόσβαση στο host σύστημα.

Γι’ αυτό δημιουργούμε έναν απλό χρήστη. Έτσι περιορίζουμε τις άδειες του container.

5. `CMD` VS `ENTRYPOINT`

  - **CMD**: δηλώνει **τι θα εκτελεστεί** όταν ξεκινήσει το container. Μπορεί να αντικατασταθεί εύκολα με άλλη εντολή στο `docker run`.
  - **ENTRYPOINT**: "κλειδώνει" την εντολή (χρησιμοποιείται σε πιο σύνθετα σενάρια).

## Βήματα Εκτέλεσης
Ανοίξτε το Terminal (ή PowerShell / CMD) μέσα στον φάκελο όπου βρίσκονται τα αρχεία και εκτελέστε:
```shell
# Create the image
docker build -t weather-requester-python .

# Spin up a container from the image
docker run --name weather -d weather-requester-python

# Check the logs
docker logs -f weather
```

## Extra: Καλή πρακτική (API key)

Προς το παρόν το API key είναι "σκληροκωδικομένο" μέσα στο αρχείο. Είναι καλύτερο να περνάμε κλειδιά / κωδικούς με την χρήση μεταβλητών περιβάλλοντος:
```shell
docker run --name weather -d ^
  -e API_KEY=dcff3a1b197264b4ba1fb5fe20a6ca4b ^
  weather-requester
```

Για να είναι εφικτό το παραπάνω, θα πρέπει και ο κώδικάς μας να μπορεί να διαχειριστή την μεταβλητή. Παρακάτω εμφανίζεται η αλλαγή:
```python
import os
key = os.getenv("API_KEY")
```

# **✅ Συμπεράσματα**
Με αυτό το παράδειγμα είδαμε πώς:
- "Τυλίγουμε" ένα απλό Python πρόγραμμα μέσα σε ένα Docker image
- Το τρέχουμε απομονωμένα και συνεχώς μέσα σε ένα container
- Διαχειριζόμαστε logs, περιβάλλον και επαναχρησιμοποιήσιμα images